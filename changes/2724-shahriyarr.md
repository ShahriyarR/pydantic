Spotted an anti-pattern which can lead to shadowing in the outer scope, as there is a function named schema.
Renamed all schema variables to schema_